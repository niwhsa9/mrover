<launch>
  <!--Node for teleop control callbacks-->
  <rosparam command="load" file="$(find mrover)/config/teleop.yaml" />
  <node name="jetson_teleop" pkg="mrover" type="jetson_teleop.py"/>
  <!--
    Run the drive program
  -->
  <node name="odrive_control" pkg="mrover" type="odrive_control.py" output="screen"></node>
  <rosparam command="load" file="$(find mrover)/config/esw.yaml" />

  <!--perception-->
  <node name="aruco_detect" pkg="mrover" type="aruco_detect" />

  <rosparam command="load" file="$(find mrover)/config/esw.yaml" />

  <node name="imu_driver" pkg="mrover" type="imu_driver.py" output="screen">
    <remap from="imu/data" to="imu" />
  </node>
  <node name="gps_driver" pkg="nmea_navsat_driver" type="nmea_serial_driver">
    <remap from="fix" to="gps/fix" />
  </node>

  <node pkg="tf" type="static_transform_publisher" name="base_to_imu" args="0 0 0 0 0 0 base_link imu_link 100" />

  <!--localization-->
  <rosparam command="load" file="$(find mrover)/config/ekf_localization.yaml" />

  <!-- Fuses together GPS position and IMU orientation with an Extended Kalman Filter (EKF) -->
  <!-- Publishes a resulting tf entry between odom and base_link -->
  <node pkg="robot_localization" type="ekf_localization_node" name="ekf_odom" clear_params="true">
    <!-- Publications -->
    <remap from="odometry/filtered" to="odometry/filtered" />
  </node>

  <!-- Reads the GPS topic and convert it to cartesian based on a reference point-->
  <node pkg="robot_localization" type="navsat_transform_node" name="navsat_transform" clear_params="true">
    <!-- Reference latitude/longitude to linearize from -->
    <rosparam param="datum">[42.2, -83.7, 0.0, map, base_link]</rosparam>
    <!-- Subscriptions -->
    <remap from="imu/data" to="imu" />
    <remap from="gps/fix" to="gps/fix" />
    <!-- Confusing: This is needed in the event that your first GPS reading comes after your robot has attained some non-zero pose -->
    <remap from="odometry/filtered" to="odometry/filtered" />
    <!-- Publications -->
    <remap from="gps/filtered" to="gps/filtered" />
    <remap from="odometry/gps" to="odometry/gps" />
  </node>
</launch>
